---
title: "Claude Code の使用量をtmuxのステータスバーでリアルタイム監視する「claude-tmux-status」を作った"
emoji: "🤖"
type: "tech"
topics: ["claudecode", "claude", "tmux", "python", "個人開発"]
published: true
published_at: "2026-02-23 13:00"
---

Claude Code を使っていると「気づいたら使用量が上限に達していた」という経験、ありませんか？

作業に集中しているとつい忘れてしまう使用量の確認。かといって別のウィンドウを開いて確認するのも手間です。

そこで、**tmuxのステータスバーに常時表示**する「claude-tmux-status」を作りました。

https://github.com/long-910/claude-tmux-status

---

## こんな画面になります

tmuxを使っていると、ターミナルの下部にこんな表示が常に出ます：

```
🤖 5h:78%(2h47m) 7d:84%!
```

これだけで「5時間ウィンドウの消費率78%、リセットまで2時間47分、週間使用率84%で警告状態」がひと目でわかります。

コスト表示モードに切り替えると：

```
🤖 5h:$9.42 day:$9.42 7d:$48.39
```

今日と今週でいくら使ったかがリアルタイムで見えます。

---

## なぜ作ったか

Claude Code の使用量制限は「5時間のローリングウィンドウ」と「週間制限」の2つで管理されています（詳細は[こちらの記事](https://zenn.dev/long910/articles/2026-02-21-claude-code-usage-limit)を参照）。

問題は、この使用量が**どこにも常時表示されない**ことです。

- 上限に達してから初めて「あ、使いすぎた」と気づく
- 別のブラウザタブやコマンドを都度開いて確認するのが面倒
- 作業フローが途切れる

tmuxユーザーであれば、ステータスバーには常にCPU使用率・時刻・バッテリー残量などを表示しているはずです。**Claude Code の使用量もそこに並べてしまおう**というのが発想の出発点です。

---

## 機能

### 表示モード1: パーセントモード（デフォルト）

```
🤖 5h:78%(2h47m) 7d:84%!
```

| 部分      | 意味                                    |
| --------- | --------------------------------------- |
| `5h:78%`  | 5時間ウィンドウの消費率                 |
| `(2h47m)` | 5時間ウィンドウのリセットまでの残り時間 |
| `7d:84%!` | 週間消費率（`!`は75%超の警告）          |

### 表示モード2: コストモード

```
🤖 5h:$9.42 day:$9.42 7d:$48.39
```

| 部分        | 意味                          |
| ----------- | ----------------------------- |
| `5h:$9.42`  | 現在の5時間ウィンドウのコスト |
| `day:$9.42` | 当日のトータルコスト          |
| `7d:$48.39` | 週間トータルコスト            |

### 表示モード3: 詳細モード（ロング表示）

```
claude-usage long
```

で、プログレスバーと全メトリクスが1画面に表示されます：

```
=== Claude Code Usage ===
5h window:  [████████░░] 78% (!WARNING) | Reset in: 2h47m
7d window:  [████████░░] 84% (!WARNING)

--- Cost Summary ---
5h cost:    $9.42
Day cost:   $9.42
7d cost:    $48.39
```

### ステータスインジケーター

| マーク   | 状態            |
| -------- | --------------- |
| （なし） | 正常（75%未満） |
| `!`      | 警告（75%以上） |
| `✗`      | 上限到達        |

---

## 必要環境

- Python 3.10 以上
- tmux 3.0 以上
- Claude Code インストール済み（`~/.claude/.credentials.json` が存在すること）

---

## インストール

```bash
git clone https://github.com/long-910/claude-tmux-status.git
cd claude-tmux-status
bash install.sh
```

`install.sh` は以下を自動で行います：

1. スクリプトを `~/.local/bin/claude-usage` にコピーして実行権限を付与
2. `~/.tmux.conf` にステータスバー表示の設定を追記
3. `Prefix + U` で表示モードを切り替えるキーバインドを設定

インストール後は新しいtmuxセッションを開くか、設定を再読み込みします：

```bash
tmux source-file ~/.tmux.conf
```

これだけで設定完了です。

---

## 使い方

### コマンド一覧

| コマンド              | 説明                                    |
| --------------------- | --------------------------------------- |
| `claude-usage`        | tmux ステータスバー用のコンパクト表示   |
| `claude-usage toggle` | パーセントモード↔コストモードを切り替え |
| `claude-usage long`   | プログレスバー付きの詳細表示            |
| `claude-usage json`   | JSON形式で全データ出力                  |

### キーバインド

tmux内で `Prefix + U` を押すと、パーセントモードとコストモードがトグルで切り替わります。

### 表示モードの永続化

選択した表示モードは `~/.claude/tmux-display-mode` に保存されるため、tmuxセッションをまたいでも設定が引き継がれます。

---

## 仕組み

### レート制限情報の取得

使用率データは、Anthropic API のレスポンスヘッダーから直接取得しています。

```
anthropic-ratelimit-unified-5h-utilization
anthropic-ratelimit-unified-7d-utilization
```

Claude Code が実際にAPIと通信するとき、これらのヘッダーに使用率が含まれています。ツールはこのデータを読み取ることで、正確なリアルタイム情報を表示します。

また、**APIレスポンスを5分間キャッシュ**しているため、tmuxが定期的にスクリプトを呼び出しても不必要なAPI通信は発生しません。

### コストの計算

コストは、Claude Code がローカルに記録している使用ログから集計します。

```
~/.claude/projects/**/*.jsonl
```

Claude Sonnet 4.x の料金体系に基づいて計算されます：

| トークン種別       | 料金（1Mトークンあたり） |
| ------------------ | ------------------------ |
| 入力トークン       | $3.00                    |
| 出力トークン       | $15.00                   |
| キャッシュ読み取り | $0.30                    |
| キャッシュ書き込み | $3.75                    |

---

## ccusage との違い

Claude Code の使用量を可視化するツールとして [ccusage](https://github.com/ryoppippi/ccusage) もあります。

| 機能                 | claude-tmux-status         | ccusage                      |
| -------------------- | -------------------------- | ---------------------------- |
| 表示場所             | tmuxステータスバー（常時） | ターミナル（要コマンド実行） |
| リアルタイム更新     | ✅                         | ❌                           |
| APIレート制限の表示  | ✅                         | ❌                           |
| 詳細な日別・月別集計 | ❌                         | ✅                           |
| インストール不要     | ❌                         | ✅（npx で即実行）           |

両者は用途が異なります。**常時監視したい**なら claude-tmux-status、**詳しく使用量を分析したい**なら ccusage、という使い分けが自然です。

組み合わせて使うのが最強です。

---

## tmuxとの相性が良い理由

tmuxのステータスバーには `status-interval` という設定があり、数秒〜数十秒ごとにコマンドを実行して表示を更新できます。

インストール後の `~/.tmux.conf` には以下のような設定が追加されます：

```bash
set -g status-interval 30
set -g status-right '#(claude-usage) | %H:%M'
```

これにより30秒ごとに `claude-usage` が実行され、最新の使用量が表示されます。5分キャッシュのおかげでAPIへの不必要なアクセスも発生しません。

---

## こんな方におすすめ

- **tmuxをメインで使っている開発者**：常時確認できるので使いすぎ防止に
- **Claude Code をヘビーに使っている方**：上限到達による作業中断を減らせます
- **コストを意識したい方**：コストモードで日々の出費をリアルタイムで把握

逆に、tmuxを使っていない場合はこのツールの恩恵を受けられません。その場合は ccusage が便利です。

---

## まとめ

Claude Code の使用量をtmuxのステータスバーに常時表示する **claude-tmux-status** を紹介しました。

- `bash install.sh` の1コマンドでセットアップ完了
- パーセントモードとコストモードをキーバインドで切り替え可能
- APIヘッダーから正確なレート制限情報を取得
- ローカルJSONLから実際のコストを集計

Claude Code を日常的に使っているtmuxユーザーの方は、ぜひ試してみてください。

スターをもらえると励みになります⭐

https://github.com/long-910/claude-tmux-status

---

## 参考リンク

- [Claude Code の使用量上限とうまく付き合う方法](https://zenn.dev/long910/articles/2026-02-21-claude-code-usage-limit) — 使用量制限の仕組みを詳しく解説
- [ccusage - GitHub](https://github.com/ryoppippi/ccusage) — 詳細な使用量分析ツール
- [tmux 公式ドキュメント](https://github.com/tmux/tmux/wiki) — status-right の設定方法など
